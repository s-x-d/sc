container_commands:
  01_create_media_dir:
    command: |
      mkdir -p /var/app/current/media
      chmod 755 /var/app/current/media
    test: "[ ! -d /var/app/current/media ]"

  02_create_nginx_conf:
    command: |
      echo 'location /media/ {
        alias /var/app/current/media/;
        expires 30d;
      }' > /etc/nginx/conf.d/elasticbeanstalk/media.conf
    test: "[ ! -f /etc/nginx/conf.d/elasticbeanstalk/media.conf ]"

  03_reload_nginx:
    command: |
      sudo service nginx reload

  04_log_test:
    command: |
      echo "Deployment was successful at $(date)" > /var/log/media_deploy_test.log